<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superbrain - Gemini Vision</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <div id="root"></div>
    
    <script>
        let apiKey = '';
        let messages = [];
        let isLoading = false;

        function render() {
            const root = document.getElementById('root');
            
            if (!apiKey) {
                root.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2 text-center">Superbrain</h1>
                            <p class="text-gray-600 text-center mb-6">Gemini Vision AI</p>
                            
                            <input type="password" id="apiKeyInput" placeholder="Enter Gemini API Key" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 mb-4">
                            
                            <button onclick="setApiKey()" 
                                class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700">
                                Start
                            </button>
                            
                            <p class="text-xs text-gray-500 text-center mt-4">Get free API key from ai.google.dev</p>
                        </div>
                    </div>
                `;
                return;
            }

            let messagesHtml = messages.length === 0 ? `
                <div class="text-center text-gray-500 mt-8">
                    <p class="text-lg">Welcome to Superbrain! ðŸ§ </p>
                    <p class="mt-2">Upload images and ask questions</p>
                </div>
            ` : '';

            messages.forEach(msg => {
                const isUser = msg.role === 'user';
                messagesHtml += `
                    <div class="flex ${isUser ? 'justify-end' : 'justify-start'} mb-4">
                        <div class="max-w-[80%] rounded-2xl px-4 py-3 ${isUser ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white' : 'bg-gray-100 text-gray-800'}">
                            ${msg.image ? `<img src="${msg.image}" class="max-w-full rounded-lg mb-2 max-h-64 object-contain">` : ''}
                            <p class="whitespace-pre-wrap">${msg.text}</p>
                        </div>
                    </div>
                `;
            });

            if (isLoading) {
                messagesHtml += `
                    <div class="flex justify-start mb-4">
                        <div class="bg-gray-100 rounded-2xl px-4 py-3">
                            <div class="animate-spin h-6 w-6 border-4 border-purple-600 border-t-transparent rounded-full"></div>
                        </div>
                    </div>
                `;
            }

            root.innerHTML = `
                <div class="max-w-4xl mx-auto p-4 h-screen flex flex-col">
                    <div class="bg-white rounded-t-2xl shadow-lg p-4 border-b">
                        <div class="flex justify-between items-center">
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Superbrain</h1>
                            <button onclick="resetApiKey()" class="text-sm text-gray-600 hover:text-gray-800">Change API</button>
                        </div>
                    </div>

                    <div class="flex-1 bg-white shadow-lg overflow-y-auto p-6" id="messagesContainer">
                        ${messagesHtml}
                    </div>

                    <div class="bg-white rounded-b-2xl shadow-lg p-4">
                        <div id="imagePreviewContainer"></div>
                        <div class="flex gap-2">
                            <input type="file" id="imageInput" accept="image/*" class="hidden">
                            <button onclick="document.getElementById('imageInput').click()" 
                                class="bg-gray-100 p-3 rounded-lg hover:bg-gray-200">
                                ðŸ“·
                            </button>
                            <input type="text" id="messageInput" placeholder="Ask about the image or upload one..." 
                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                onkeypress="if(event.key==='Enter') sendMessage()">
                            <button onclick="sendMessage()" 
                                class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-purple-700 hover:to-blue-700">
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            `;

            const container = document.getElementById('messagesContainer');
            if (container) container.scrollTop = container.scrollHeight;
        }

        function setApiKey() {
            const input = document.getElementById('apiKeyInput');
            if (input.value.trim()) {
                apiKey = input.value.trim();
                render();
            }
        }

        function resetApiKey() {
            apiKey = '';
            messages = [];
            render();
        }

        let selectedImage = null;
        let imagePreview = null;

        document.addEventListener('change', function(e) {
            if (e.target.id === 'imageInput') {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imagePreview = event.target.result;
                        selectedImage = imagePreview.split(',')[1];
                        
                        const preview = document.getElementById('imagePreviewContainer');
                        preview.innerHTML = `
                            <div class="mb-3 relative inline-block">
                                <img src="${imagePreview}" class="max-h-32 rounded-lg border-2 border-purple-200">
                                <button onclick="clearImage()" 
                                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 hover:bg-red-600">Ã—</button>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        function clearImage() {
            selectedImage = null;
            imagePreview = null;
            document.getElementById('imageInput').value = '';
            document.getElementById('imagePreviewContainer').innerHTML = '';
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text && !selectedImage) return;
            if (isLoading) return;

            const userMessage = text || "Analyze this image";
            
            messages.push({
                role: 'user',
                text: userMessage,
                image: imagePreview
            });

            input.value = '';
            isLoading = true;
            render();

            try {
                const parts = [];
                
                if (selectedImage) {
                    parts.push({
                        inline_data: {
                            mime_type: "image/jpeg",
                            data: selectedImage
                        }
                    });
                }
                
                parts.push({ text: userMessage });

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: parts
                        }]
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || `API Error: ${response.status}`);
                }

                const assistantText = data.candidates[0].content.parts[0].text;
                
                messages.push({
                    role: 'assistant',
                    text: assistantText
                });

                clearImage();
            } catch (error) {
                messages.push({
                    role: 'assistant',
                    text: `Error: ${error.message}\n\nMake sure:\n- Your API key is valid\n- You have Gemini API access at ai.google.dev\n- Your API key supports vision models`
                });
            } finally {
                isLoading = false;
                render();
            }
        }

        render();
    </script>
</body>
</html>
